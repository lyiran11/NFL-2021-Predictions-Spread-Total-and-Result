---
title: "Playoffs Round 2 Data"
author: "Sam Moore"
date: "10/13/2021"
output: html_document
---

```{r, echo = F}
#install.packages("nflfastR")


library(nflfastR)
library(tidyverse)
library(janitor)
library(readr)
library(class)
library(tidyverse)
library(caret)
library(leaps)
library(MASS)
library(dplyr)
```

```{r}
results = read_csv(url("https://raw.githubusercontent.com/mattymo18/STOR-538-P2-2021-Spring/master/Source_Data/game_results.csv"))

#Play-by-Play Data in R

data2010 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2010.rds'))
data2011 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2011.rds'))
data2012 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2012.rds'))
data2013 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2013.rds'))
data2014 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2014.rds'))
data2015 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2015.rds'))
data2016 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2016.rds'))
data2017 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2017.rds'))
data2018 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2018.rds'))
data2019 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2019.rds'))
data2020 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2020.rds'))
data2021 <- readRDS(url('https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2021.rds'))
```


```{r}
#Aggregate to Game Level

GAME2010=data2010 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                      TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())





GAME2011=data2011 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())



GAME2012=data2012 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())



GAME2013=data2013 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())




GAME2014=data2014 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())



GAME2015=data2015 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())




GAME2016=data2016 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())





GAME2017=data2017 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())





GAME2018=data2018 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())





GAME2019=data2019 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())





GAME2020=data2020 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())





GAME2021=data2021 %>%
            group_by(game_id,posteam,posteam_type) %>%
            summarize(Total_Yds=sum(yards_gained,na.rm=T), 
                      TD_Pass=sum(pass_touchdown,na.rm=T),
                      TD_Rush=sum(rush_touchdown,na.rm=T),
                      FGA=sum(field_goal_attempt,na.rm=T),
                      FGM=sum(field_goal_result=="made",na.rm=T),
                      EPA=sum(extra_point_attempt,na.rm=T),
                      EPM=sum(extra_point_result=="good",na.rm=T),
                      TPCA=sum(two_point_attempt,na.rm=T),
                      TPCM=sum(two_point_conv_result=="success",na.rm=T),
                      SAFETY=sum(safety,na.rm=T),
                      RUSH_yds=sum(rush_attempt*yards_gained,na.rm=T),
                      PASS_yds=sum(pass_attempt*yards_gained,na.rm=T),
                      RA=sum(rush_attempt,na.rm=T),
                      PA=sum(pass_attempt,na.rm=T),
                      R_YpA = RUSH_yds/RA,
                      P_YpA = PASS_yds/PA,
                      INT = sum(interception, na.rm = T),
                      THIRD_PCT = (sum(third_down_converted, na.rm = T)/(sum(third_down_converted, na.rm = T) 
                                  + sum(third_down_failed, na.rm = T))),
                      FOURTH_PCT = (sum(fourth_down_converted, na.rm = T)/(sum(fourth_down_converted, na.rm = T)
                                  + sum(fourth_down_failed, na.rm = T))),
                      SACK = sum(sack, na.rm = T),
                      COMP = sum(complete_pass, na.rm = T),
                      COMP_PCT = sum(complete_pass, na.rm = T)/sum(pass_attempt, na.rm = T),
                      FG_PCT = sum(field_goal_result == "made", na.rm = T)/sum(field_goal_attempt, na.rm = T),
                      PEN = sum(penalty, na.rm = T),
                      PEN_YDS = sum(penalty_yards, na.rm = T),
                       TOTAL_TO = sum(interception, na.rm = T) + sum(fumble_lost, na.rm = T)) %>%
            mutate(posteam_type=ifelse(posteam_type=="away","Away","Home")) %>%
            filter(posteam!="") %>%
            ungroup() %>%
            mutate(Points=6*TD_Pass+6*TD_Rush+3*FGM+1*EPM+2*TPCM+2*SAFETY,
                   P_to_R=RA/PA) %>%
            separate(game_id,into=c("YEAR","WEEK","AWAYCITY","HOMECITY"),sep="_") %>%
            mutate(posteam=ifelse(posteam=="LA","LAR",posteam)) %>%
            select(YEAR,WEEK,AWAYCITY,HOMECITY,everything())


```

```{r}
#Split game into home and away
GAME2010AWAY = GAME2010 %>% filter(posteam_type == "Away")
GAME2010HOME = GAME2010 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2010 = left_join(GAME2010HOME, GAME2010AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2010.2 = newgame2010 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2010.2$Year = as.integer(newgame2010.2$Year)
  newgame2010$conv_adv = newgame2010$`3rd_PCT_H`
  
  

GAME2011AWAY = GAME2011 %>% filter(posteam_type == "Away")
GAME2011HOME = GAME2011 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2011 = left_join(GAME2011HOME, GAME2011AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2011.2 = newgame2011 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x,  "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2011.2$Year = as.integer(newgame2011.2$Year)
  

GAME2012AWAY = GAME2012 %>% filter(posteam_type == "Away")
GAME2012HOME = GAME2012 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2012 = left_join(GAME2012HOME, GAME2012AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2012.2 = newgame2012 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2012.2$Year = as.integer(newgame2012.2$Year)

  
  
GAME2013AWAY = GAME2013 %>% filter(posteam_type == "Away")
GAME2013HOME = GAME2013 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2013 = left_join(GAME2013HOME, GAME2013AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2013.2 = newgame2013 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2013.2$Year = as.integer(newgame2013.2$Year)
  

GAME2014AWAY = GAME2014 %>% filter(posteam_type == "Away")
GAME2014HOME = GAME2014 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2014 = left_join(GAME2014HOME, GAME2014AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2014.2 = newgame2014 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2014.2$Year = as.integer(newgame2014.2$Year)
  
  

GAME2015AWAY = GAME2015 %>% filter(posteam_type == "Away")
GAME2015HOME = GAME2015 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2015 = left_join(GAME2015HOME, GAME2015AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2015.2 = newgame2015 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2015.2$Year = as.integer(newgame2015.2$Year)
  

  
GAME2016AWAY = GAME2016 %>% filter(posteam_type == "Away")
GAME2016HOME = GAME2016 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2016 = left_join(GAME2016HOME, GAME2016AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2016.2 = newgame2016 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2016.2$Year = as.integer(newgame2016.2$Year)

  
GAME2017AWAY = GAME2017 %>% filter(posteam_type == "Away")
GAME2017HOME = GAME2017 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2017 = left_join(GAME2017HOME, GAME2017AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2017.2 = newgame2017 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2017.2$Year = as.integer(newgame2017.2$Year)

  
GAME2018AWAY = GAME2018 %>% filter(posteam_type == "Away")
GAME2018HOME = GAME2018 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2018 = left_join(GAME2018HOME, GAME2018AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2018.2 = newgame2018 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2018.2$Year = as.integer(newgame2018.2$Year)

  
  
GAME2019AWAY = GAME2019 %>% filter(posteam_type == "Away")
GAME2019HOME = GAME2019 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2019 = left_join(GAME2019HOME, GAME2019AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2019.2 = newgame2019 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2019.2$Year = as.integer(newgame2019.2$Year)

  
GAME2020AWAY = GAME2020 %>% filter(posteam_type == "Away")
GAME2020HOME = GAME2020 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2020 = left_join(GAME2020HOME, GAME2020AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2020.2 = newgame2020 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2020.2$Year = as.integer(newgame2020.2$Year)

  
  
GAME2021AWAY = GAME2021 %>% filter(posteam_type == "Away")
GAME2021HOME = GAME2021 %>% filter(posteam_type == "Home")

#join by the cities and week to ensure no duplicates
newgame2021 = left_join(GAME2021HOME, GAME2021AWAY, by = c("AWAYCITY", "HOMECITY", "WEEK"))

#select and rename the variables to have a much more tidy data set.
newgame2021.2 = newgame2021 %>% select("Year" = YEAR.x, WEEK, AWAYCITY, HOMECITY, "Home_Team" = posteam.x, "Total Yards_H" = Total_Yds.x, "TD Pass_H" = TD_Pass.x, "TD Rush_H" = TD_Rush.x, "FGA_H" = FGA.x, "FGM_H" = FGM.x, "EPA_H" = EPA.x, "EPM_H" = EPM.x, "2PCA_H" = TPCA.x, "2PCM_H" = TPCM.x, "SFTY_H" = SAFETY.x, "Rush_Yards_H" = RUSH_yds.x, "Pass_Yards_H" = PASS_yds.x, "RA_H" = RA.x, "PA_H" = PA.x, "Rush_YpA_H" = R_YpA.x, "Pass_YpA_H" = P_YpA.x, "INT_H" = INT.x, "SACK_H" = SACK.x, "3rd_PCT_H" = THIRD_PCT.x, "4th_PCT_H" = FOURTH_PCT.x, "COMP_H" = COMP.x, "COMP_PCT_H" = COMP_PCT.x, "FG_PCT_H" = FG_PCT.x, "PEN_H" = PEN.x, "PEN_YDS_H" = PEN_YDS.x, "TO_H" = TOTAL_TO.x, "HOME_PTS" = Points.x, "Pass/Rush_Ratio_H" = P_to_R.x, "Away_Team" = posteam.y, "Total Yards_A" = Total_Yds.y, "TD Pass_A" = TD_Pass.y, "TD Rush_A" = TD_Rush.y, "FGA_A" = FGA.y, "FGM_A" = FGM.y, "EPA_A" = EPA.y, "EPM_A" = EPM.y, "2PCA_A" = TPCA.y, "2PCM_A" = TPCM.y, "SFTY_A" = SAFETY.y, "Rush_Yards_A" = RUSH_yds.y, "Pass_Yards_A" = PASS_yds.y, "RA_A" = RA.y, "PA_A" = PA.y, "Rush_YpA_A" = R_YpA.y, "Pass_YpA_A" = P_YpA.y, "INT_A" = INT.y, "SACK_A" = SACK.y, "3rd_PCT_A" = THIRD_PCT.y, "4th_PCT_A" = FOURTH_PCT.y, "COMP_A" = COMP.y, "COMP_PCT_A" = COMP_PCT.y, "FG_PCT_A" = FG_PCT.y, "PEN_A" = PEN.y, "PEN_YDS_A" = PEN_YDS.y,"TO_A" = TOTAL_TO.y, "AWAY_PTS" = Points.y, "Pass/Rush_Ratio_A" = P_to_R.y)
  
  newgame2021.2$Year = as.integer(newgame2021.2$Year)



```


```{r}
#offensive data import

y2000_off_stats = read.csv("P2.2000.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp") 



y2001_off_stats = read.csv("P2.2001.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 2, 3, 4, 5)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2002_off_stats = read.csv("P2.2002.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33))  %>%  rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2003_off_stats = read.csv("P2.2003.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2004_off_stats = read.csv("P2.2004.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2005_off_stats = read.csv("P2.2005.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2006_off_stats = read.csv("P2.2006.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2007_off_stats = read.csv("P2.2007.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2008_off_stats = read.csv("P2.2008.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2009_off_stats = read.csv("P2.2009.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2010_off_stats = read.csv("P2.2010.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")

y2010_off_stats$Year = c(rep.int(2010, times = 35))


y2011_off_stats = read.csv("P2.2011.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")

y2011_off_stats$Year = c(rep.int(2011, times = 35))


y2012_off_stats = read.csv("P2.2012.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")

y2012_off_stats$Year = c(rep.int(2012, times = 35))


y2013_off_stats = read.csv("P2.2013.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2014_off_stats = read.csv("P2.2014.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2015_off_stats = read.csv("P2.2015.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2016_off_stats = read.csv("P2.2016.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2017_off_stats = read.csv("P2.2017.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2018_off_stats = read.csv("P2.2018.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2019_off_stats = read.csv("P2.2019.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-c(1, 30, 31, 32, 33)) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2020_off_stats = read.csv("P2.2020.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2021_off_stats = read.csv("P2.2021.Off.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2013_off_stats$Year = c(rep.int(2013, times = 35))
y2014_off_stats$Year = c(rep.int(2014, times = 35))
y2015_off_stats$Year = c(rep.int(2015, times = 35))
y2016_off_stats$Year = c(rep.int(2016, times = 35))
y2017_off_stats$Year = c(rep.int(2017, times = 35))
y2018_off_stats$Year = c(rep.int(2018, times = 35))
y2019_off_stats$Year = c(rep.int(2019, times = 35))
y2020_off_stats$Year = c(rep.int(2020, times = 35))
y2021_off_stats$Year = c(rep.int(2021, times = 35))
```



```{r}
total_off_stats = rbind(y2010_off_stats, y2011_off_stats, y2012_off_stats, y2013_off_stats, y2014_off_stats, y2015_off_stats, y2016_off_stats, y2017_off_stats, y2018_off_stats, y2019_off_stats, y2020_off_stats)

conversions = read.csv("conversions.csv")

conversions = conversions %>% select(Year, Team = Tm, "3rd_Pct" = X3rd_Pct, "4th_Pct" = X4th_Pct, )

#conversions

complete_off_stats = inner_join(total_off_stats, conversions, by = c("Year", "Team"))







```


```{r}
#defensive stats import and organization
y2000_def_stats = read.csv("P2.2000.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2001_def_stats = read.csv("P2.2001.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2002_def_stats = read.csv("P2.2002.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2003_def_stats = read.csv("P2.2003.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2004_def_stats = read.csv("P2.2004.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2005_def_stats = read.csv("P2.2005.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2006_def_stats = read.csv("P2.2006.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2007_def_stats = read.csv("P2.2007.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2008_def_stats = read.csv("P2.2008.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2009_def_stats = read.csv("P2.2009.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2010_def_stats = read.csv("P2.2010.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2011_def_stats = read.csv("P2.2011.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2012_def_stats = read.csv("P2.2012.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2013_def_stats = read.csv("P2.2013.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2014_def_stats = read.csv("P2.2014.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2015_def_stats = read.csv("P2.2015.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2016_def_stats = read.csv("P2.2016.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2017_def_stats = read.csv("P2.2017.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2018_def_stats = read.csv("P2.2018.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2019_def_stats = read.csv("P2.2019.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2020_def_stats = read.csv("P2.2020.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


y2021_def_stats = read.csv("P2.2021.Def.Stats.csv") %>% row_to_names(2, remove_rows_above = T, remove_row = T) %>% clean_names() %>% subset(select=-1) %>% rename("Rank" = "rk", "Team" = "tm", "Games" = "g", "Points For" = "pf", "Total Yards" = "yds", "Total Plays"="ply", "Total Y/P" = "y_p", "Total TO" = "to", "Fumbles Lost" = "fl", "Total 1D" = "x1st_d", "P Comp" = "cmp", "P ATT" = "att", "P YDS" = "yds_2", "P TD" = "td", "INT" = "int", "Net Yards per Att" = "ny_a", "P 1D" = "x1st_d_2", "R ATT" = "att_2", "R YDS" = "yds_3", " R TD" = "td_2", "Rush Y/A" = "y_a", "R 1D" = "x1st_d_3", "Pen" = "pen", "Pen Yards" = "yds_4", "Pen 1D" = "x1st_py", "Score%" = "sc_percent", "TO%" = "to_percent", "Expected Pt Diff" = "exp")


```



- Extra Data Ideas: FiveThirtyEight [Elo Data](https://github.com/fivethirtyeight/data/tree/master/nfl-elo) to help predict results.

- Some important advanced stats for Defense (Pressure %, sacks, hurry pct, missed tackles)

- for the first data set we will want to also see if we can add in defensive stats 

- Engineered Variable idea: 

- A couple of notes: I think our project will be easier than the Basketball project sample because we really only have to create a predictive model for points, and then 

```{r}

TD_out_model = lm(HOME_PTS ~  FGA_H + EPA_H  + `2PCA_H` + `Total Yards_H`+ Rush_Yards_H + Pass_Yards_H + RA_H + PA_H + INT_H + SACK_H + COMP_H + COMP_PCT_H + FG_PCT_H + FG_PCT_A + PEN_H + PEN_YDS_H + `Pass/Rush_Ratio_H`, newgame2010.2, method = "qr")

anova(TD_out_model)

summary(TD_out_model)


```

```{r}

#Importing Elo Ratings

elo = read.csv("nfl_games_elo.csv")



newgame2010.3 = left_join(newgame2010.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2011.3 = left_join(newgame2011.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2012.3 = left_join(newgame2012.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2013.3 = left_join(newgame2013.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2014.3 = left_join(newgame2014.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2015.3 = left_join(newgame2015.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2016.3 = left_join(newgame2016.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2017.3 = left_join(newgame2017.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2018.3 = left_join(newgame2018.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2019.3 = left_join(newgame2019.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2020.3 = left_join(newgame2020.2, elo, by = c("Year", "Home_Team", "Away_Team"))
newgame2021.3 = left_join(newgame2021.2, elo, by = c("Year", "Home_Team", "Away_Team"))

#merge into 1 data set
total_games = rbind(newgame2010.3, newgame2011.3, newgame2012.3, newgame2013.3, newgame2014.3, newgame2015.3, newgame2016.3, newgame2017.3, newgame2018.3, newgame2019.3, newgame2020.3, newgame2021.3)



#toal, spread, winloss
total_games$Spread = total_games$HOME_PTS - total_games$AWAY_PTS
total_games$Total <- total_games$HOME_PTS + total_games$AWAY_PTS
total_games$WINLOSS <- ifelse(total_games$HOME_PTS < total_games$AWAY_PTS,0,1)

#replace na's i field goal percentage to 0's
total_games$FG_PCT_H[is.nan(total_games$FG_PCT_H)] = 0
total_games$FG_PCT_A[is.nan(total_games$FG_PCT_A)] = 0

#New Variable 
total_games$New_Var = total_games$'3rd_PCT_H' / total_games$'3rd_PCT_A'

#Convert Infinite values to NA's 
is.na(total_games) <- sapply(total_games, is.infinite)

totalgames_noTD_noFG <- select(total_games, select = -c(`TD Rush_H`,`TD Pass_H`, `TD Rush_A`, `TD Pass_A`, `FGM_H`, `FGM_A`, `FGA_H`, `FGA_A`))

totalgames_noTD_noFG$`4th_PCT_A`[is.nan(totalgames_noTD_noFG$`4th_PCT_A`)]=0
totalgames_noTD_noFG$`4th_PCT_H`[is.nan(totalgames_noTD_noFG$`4th_PCT_H`)]=0

#Train and test separation
set.seed(406)

smp_size <- floor(0.75 * nrow(totalgames_noTD_noFG))

train_index <- sample(seq_len(nrow(totalgames_noTD_noFG)), size = smp_size)

games_train <- totalgames_noTD_noFG[train_index, ]
games_test <- totalgames_noTD_noFG[-(train_index), ]

totalgames_formodel = select(totalgames_noTD_noFG, select = -c(`Year`, `WEEK`, `AWAYCITY`,`HOMECITY`,`Home_Team`,`Away_Team`,`Total Yards_H`, `Total Yards_A`,`HOME_PTS`,`AWAY_PTS`))
```

Spread
```{r}
totalgames_formodel_spread = select(totalgames_formodel, select = -c(`Total`, `WINLOSS`))

spread_lm1 = lm(Spread ~ ., data = totalgames_formodel_spread)
summary(spread_lm1)

```
```{r}
spread_lm2 = lm(Spread ~ `EPA_H`+`EPM_H`+`EPA_A`+`EPM_A`+`2PCA_H`+`2PCM_H`+`2PCA_A`+`2PCM_A`+`SFTY_H`+`SFTY_A`+`Rush_Yards_H`+`Pass_Yards_H`+`Rush_YpA_H`+`FG_PCT_H`+`PEN_H`+`PEN_YDS_H`+`FG_PCT_A`+`PEN_A`+`PEN_YDS_A`+`TO_H`+`TO_A`, data = totalgames_formodel_spread)
summary(spread_lm2)
```
```{r}
spread_lm3 = lm(Spread ~ `EPA_H`+`EPM_H`+`EPA_A`+`EPM_A`+`2PCA_H`+`2PCM_H`+`2PCA_A`+`2PCM_A`+`SFTY_H`+`SFTY_A`+`Rush_Yards_H`+`Pass_Yards_H`+`Rush_YpA_H`+`FG_PCT_H`+`PEN_YDS_H`+`FG_PCT_A`+`PEN_YDS_A`+`TO_H`+`TO_A`, data = totalgames_formodel_spread)
summary(spread_lm3)
```

Test the accuracy of linear regression model:
```{r}
#final matrix for lr:
spread_lr = totalgames_formodel_spread[,c(1,3,4,5,6,7,10,18,20,21,23,24,25,26,40,42,43,47)]

#split train test:
set.seed(406)

size <- floor(0.75 * nrow(spread_lr))

train_index <- sample(seq_len(nrow(spread_lr)), size = size)

spread_lr_train <- spread_lr[train_index, ]
spread_lr_test <- spread_lr[-(train_index), ]

spread_lrm_train = lm(Spread ~ ., data = spread_lr_train)
summary(spread_lrm_train)

predict_spread_test = predict.lm(spread_lrm_train, newdata = spread_lr_test)

rmse_lrm_spread = RMSE(predict_spread_test, spread_lr_test$Spread)
rmse_lrm_spread
```

Total Games Step-wise Polynomial regression 

```{r}

spreadmod = lm(Spread ~  `3rd_PCT_H`  + `TD Rush_H` + `TD Pass_H` + `TD Rush_H`* `TD Pass_H`*`TO_H`+ RA_H + PA_H + SFTY_H + PEN_YDS_H  + `3rd_PCT_A`  + AWAY_PTS+ `TD Rush_A`+ `TD Pass_A`  + elo_H + elo_A + TO_A + FGM_H + FGM_A , data = games_train)

summary(spreadmod)
```



```{r} 

home_mod = lm(HOME_PTS ~ Rush_YpA_H + Pass_YpA_H + FG_PCT_H + COMP_PCT_H + `3rd_PCT_H`  + TO_H + TO_A + `Total Yards_H` + PEN_YDS_H + SFTY_H , data = games_train)

#summary(home_mod)


```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
TG<- read.csv("TG.csv",check.names = FALSE)
```
```{r}
library(caret)
library(class)
```

```{r}
#dataset with everything
#TG_ALLVARS <- read.csv("total_games_noNaN1.csv",check.names = FALSE)
#TG_ALLVARS <- na.omit(TG_ALLVARS)
```

Ignore chunk below:
```{r}
spread_all <- lm(Spread~., data = subset(TG_ALLVARS, select = -c(Total, WINLOSS, WEEK, AWAYCITY, HOMECITY,Year, )))
#summary(spread_all)
summary(stepAIC(spread_all, direction = "backward", trace = FALSE))
```

Setting Seed and Dividing Dataset into Test and Train
```{r}
set.seed(406)
smp_size <- floor(0.75 * nrow(TG))
train_index <- sample(seq_len(nrow(TG)), size = smp_size)
games_train <- TG[train_index, ]
games_test <- TG[-train_index, ]
```

spread_knn
```{r}
set.seed(1)

tuneGrid <- expand.grid(
  k = seq(3, 20, by = 2)
)

ctrl <- trainControl(
  method = "cv",
  number = 10,
)

model_spread_knn <- train(
  Spread ~ .,
  data = games_train[,-c(44,45)],
  method = 'knn',
  preProcess = c("center", "scale"),
  trControl = ctrl,
  tuneGrid = tuneGrid
)
model_spread_knn
plot(model_spread_knn)

pred_spread = predict(model_spread_knn, newdata = games_test[,-c(43,44,45)])

# RMSE
sqrt(mean((games_test$Spread - pred_spread)^2))
#MAE
mean(abs(games_test$Spread - pred_spread))
# R2
cor(games_test$Spread, pred_spread) ^ 2
```
Logistic regression for W/L
```{r}
# Logistic regression model for W/L
result_train = games_train[,-c(43,44)]
result_test = games_test[,-c(43,44)]
result_logit_reg <- glm(WINLOSS ~ ., data = result_train, family = binomial)

#Prediction on testing data
result_logit_reg_prob <- predict(result_logit_reg, result_test, type = "response")
result_logit_reg_pred <- ifelse(result_logit_reg_prob >= 0.5, 1, 0)

#Error rate in Logistic regression for W/L
result_logit_reg_R <- 100 * sum(result_logit_reg_pred != result_test$WINLOSS)/length(result_test$WINLOSS)
result_logit_reg_R
```
```{r}
expected = result_test$WINLOSS
confusionMatrix(as.integer(result_logit_reg_pred),expected)
```

```{r}
result_logit_reg2 <- glm(WINLOSS ~ `FGA_H` + `EPA_H` + `FGA_A` + `EPA_A`+ `FG_PCT_H`+ `FG_PCT_A`+`2PCA_H`+`2PCA_A`, data = result_train, family = binomial)

result_logit_reg_prob2 <- predict(result_logit_reg2, result_test, type = "response")
result_logit_reg_pred2 <- ifelse(result_logit_reg_prob2 >= 0.5, 1, 0)

#Error rate in Logistic regression for W/L
result_logit_reg_R2 <- 100 * sum(result_logit_reg_pred != result_test$WINLOSS)/length(result_test$WINLOSS)
result_logit_reg_R2

summary(result_logit_reg2)
```


```{r}
#rf_model = randomForest(x=x_result_train, y=y_result_train,  xtest = x_result_test, ytest = y_result_test, proximity = TRUE)
library(tree)
#result_train$`2PCA_H`

```


Ridge Regression for W/L
```{r}
set.seed(2020)
x_result_train = as.matrix(subset(result_train, select=-WINLOSS))
y_result_train = result_train$WINLOSS

x_result_test = as.matrix(subset(result_test, select=-WINLOSS))
y_result_test = result_test$WINLOSS

lambdas <- 10^seq(2, -3, by = -.1)
result_ridge_reg = glmnet(x_result_train, y_result_train, nlambda = 25, alpha = 0, family = 'gaussian', lambda = lambdas)
result_ridge_cv <- cv.glmnet(x_result_train, y_result_train, alpha = 0, lambda = lambdas)

# Best lambda value for result
result_best_lambda_ridge <- result_ridge_cv$lambda.min
result_best_lambda_ridge

# Best ridge regression model for result
result_best_ridge <- glmnet(x_result_train, y_result_train, alpha = 0, lambda = result_best_lambda_ridge)
#coef(result_best_ridge)

# Predict on testing data
result_ridge_reg_prob <- predict(result_best_ridge, s = result_best_lambda_ridge, newx = x_result_test, type = "class")
result_ridge_reg_pred <- ifelse(result_ridge_reg_prob >= 0.5, 1, 0)

#Error rate in Ridge regression for W/L
result_ridge_reg_R <- 100 * sum(result_ridge_reg_pred != result_test$WINLOSS)/length(result_test$WINLOSS)
result_ridge_reg_R
```


Lasso Regression for Result
```{r}
x_result_train = result_train[,-c(43)]
y_result_train = result_train[,43]
x_result_test = result_test[,-c(43)]
y_result_test = result_test[,43]
  
#lasso.heart = glmnet(as.matrix(scale_heart.lasso[train,-12]), Y[train], alpha=1)

#library(glmnet)
#lambdas <- 10^seq(2, -3, by = -.1)

set.seed(2021)
result_lasso_reg <- glmnet(x_result_train, y_result_train, alpha = 1, standardize = TRUE, nfolds = 10)

result_lasso_regcv <- cv.glmnet(as.matrix(x_result_train), y_result_train, alpha = 1, standardize = TRUE)

# Best lambda value for result
result_best_lambda_lasso <- result_lasso_regcv$lambda.min
result_best_lambda_lasso

# Best Lasso regression model for result
#result_best_lasso <- glmnet(as.matrix(x_result_train), y_result_train, alpha = 1, lambda = result_best_lambda_lasso, standardize = TRUE)
#coef(result_best_lasso)

#Prediction on testing data
result_lasso_reg_prob <- predict(result_lasso_reg, s = result_best_lambda_lasso, newx = as.matrix(x_result_test))
result_lasso_reg_pred <- ifelse(result_lasso_reg_prob >= 0.5, 1, 0)

#Error rate in Lasso regression for W/L
result_lasso_reg_R <- 100 * sum(result_lasso_reg_pred != result_test$WINLOSS)/length(result_test$WINLOSS)
result_lasso_reg_R
```


spread knn without elo
```{r}
#spread_knn without elo
model6 <- train(
  Spread ~ .,
  data = games_train[,-c(41,42,44,45)],
  method = 'knn',
  preProcess = c("center", "scale"),
  trControl = ctrl,
  tuneGrid = tuneGrid
)
model6

pred_spread2 = predict(model6, newdata = games_test[,-c(41,42,43,44,45)])

# RMSE
sqrt(mean((games_test$Spread - pred_spread2)^2))
# R2
cor(games_test$Spread, pred_spread2) ^ 2
```

total_knn
```{r}
model_total_knn <- train(
  Total ~ .,
  data = games_train[,-c(43,45)],
  method = 'knn',
  preProcess = c("center", "scale"),
  trControl = ctrl,
  tuneGrid = tuneGrid
)
model_total_knn
plot(model_total_knn)

pred_total = predict(model_total_knn, newdata = games_test[,-c(43,44,45)])

# RMSE
sqrt(mean((games_test$Total - pred_total)^2))
#MAE
mean(abs(games_test$Total - pred_total))
# R2
cor(games_test$Total, pred_total) ^ 2
```

W/L KNN
```{r}
#install.packages("class")
#library(class)

# scale the dataset (for predictors only):
wl_x_knn = as.data.frame(scale(TG[,-c(43,44,45)], center=T,scale=T))
wl_y_knn = TG[,-c(43,44)]$WINLOSS

#combine x and y
#spread_knn = cbind(spread_x_knn,spread_y_knn)

set.seed (1)
iter <- 20  #iteration of K


n = nrow(wl_x_knn)
times =rep(1:6,c(1/6*n,1/6*n,1/6*n,1/6*n,1/6*n,1/6*n))
ntimes = length(times)
sets = sample(times)
all_knn_cv = cbind()

set.seed (1)

# Compute accuracy on test set.
all_knn_cv_test = cbind()
for (i in 1:6) {
  cv_test = wl_x_knn[sets==i,]
  cv_train = wl_x_knn[sets!=i,]
  Y_train = wl_y_knn[sets!=i]
  Y_test = wl_y_knn[sets==i]
  
  
  

  # Compute testing set accuracy.
 errs <- vapply(seq_len(iter), function(x){
    k <- knn(cv_train, cv_test, Y_train, k = x)
   sum(k != Y_test) / length(k)
  }, numeric(1))

  all_knn_cv_test = cbind(all_knn_cv_test,errs)  
}

mean_err_test = c()
for (i in 1:20){
  mean_err_test = c(mean_err_test, mean(all_knn_cv_test[i,]))
}

df_test <- data.frame(k = seq_len(iter), accuracy = 1-mean_err_test)

#plot the accuracy:
#library(ggplot2)
#library(tidyverse)
ggplot() + 
  geom_line(data = df_test, stat = "identity", aes(x=k,y=accuracy,color="testing"))+
  scale_colour_manual("", 
                      breaks = c("testing"),
                      values = c("blue"))+
  ggtitle("Accuracy of Testing Set using KNN value of k=1 to 20") + 
  xlim(1, iter)
```


```{r}
predictor_set <- read.csv("predictor_set.csv",check.names = FALSE)
```

```{r}
library(FNN)
```

Total Games Dataset For Spread, Total, Result
```{r}
TG_spread <- subset(TG, select = -c(Total, WINLOSS)) #Total Games without Total and WINLOSS variables for Spread
TG_total <- subset(TG, select = -c(Spread, WINLOSS)) #Total Games without Total and WINLOSS variables for Total
TG_result <- subset(TG, select = -c(Spread, Total)) #Total Games without Total and WINLOSS variables for Result
```

Creating train and test datasets based on what we are trying to predict
```{r}
spread_train<- subset(games_train, select = -c(Total, WINLOSS))
spread_test<- subset(games_test, select = -c(Total, WINLOSS))
total_train<- subset(games_train, select = -c(Spread, WINLOSS))
total_test<- subset(games_test, select = -c(Spread, WINLOSS))
result_train<- subset(games_train, select = -c(Spread, Total))
result_test<- subset(games_test, select = -c(Spread, Total))
```

Baseline Linear Regression for Spread - Rsquared = 0.9195 
```{r}
#spread liner reg baseline
spread_lm_basel <- lm(Spread ~ .  , data = TG_spread)
summary(spread_lm_basel) #R2 = 0.9195 
```

Baseline Linear Regression for Spread Prediction - RSME = 3.791118
```{r}
spread_lm_basel_train <- lm(Spread ~ .  , data = spread_train)
summary(spread_lm_basel_train) #R2 = 0.9193 
predict_spread_lm_basel <- predict.lm(spread_lm_basel_train, newdata = spread_test)
rmse_spread_lm_basel <- RMSE(predict_spread_lm_basel, spread_test$Spread)
rmse_spread_lm_basel #RSME = 3.791118
```

Manual Backwise Prediction - w/ mostly significant value - R2 = 0.9197
```{r}
summary(lm(formula = Spread ~ FGA_H + EPA_H + `2PCA_H` + Rush_Yards_H + 
    Pass_Yards_H +  Rush_YpA_H + Pass_YpA_H  + 
     `4th_PCT_H`  + 
    FG_PCT_H   + 
    FGA_A + EPA_A + `2PCA_A` + 
    RA_A + PA_A + Rush_YpA_A + Pass_YpA_A  + 
    `3rd_PCT_A` + FG_PCT_A + 
    PEN_YDS_A  + elo_H + 
     Third_Down_Ratio, data = TG_spread))
```

Manual Backwise Prediction - w/ all significant values - R2 = 0.9196 
```{r}
summary(lm(formula = Spread ~ FGA_H + EPA_H + `2PCA_H` + Rush_Yards_H + 
    Pass_Yards_H +  Rush_YpA_H + 
    FG_PCT_H   + 
    FGA_A + EPA_A + `2PCA_A` + 
    RA_A + PA_A + Rush_YpA_A + Pass_YpA_A  + 
    `3rd_PCT_A` + FG_PCT_A + 
    PEN_YDS_A  + elo_H + 
     Third_Down_Ratio, data = TG_spread))
```


```{r}
library(MASS)
```

```{r}
spread_lm_for<- stepAIC(spread_lm_basel, direction = "forward", trace = FALSE)
summary(spread_lm_for)
```
```{r}
spread_lm_bi<- stepAIC(spread_lm_basel, direction = "both", trace = FALSE)
summary(spread_lm_bi)
```


```{r}
spread_lm_back<- stepAIC(spread_lm_basel, direction = "backward", trace = FALSE)
summary(spread_lm_back)
```


```{r}
spread_lm_for1<- step(spread_lm_basel, direction = "forward", trace = FALSE)
summary(spread_lm_for1)
```
```{r}
spread_lm_back1<- step(spread_lm_basel, direction = "backward", trace = FALSE)
summary(spread_lm_back1)
```

```{r}
spread_lm_bi1<- step(spread_lm_basel, direction = "both", trace = FALSE)
summary(spread_lm_bi1)
```

KNN Regression for Spread
```{r}
#knnreg_spread_k1<-knn.reg(train = spread_train, test = spread_test, y=spread_train$Spread, k=5)
#knnreg_spread_k1

# scale the dataset (for predictors only):
spread_x_knn = as.data.frame(scale(TG_spread[,-43], center=T,scale=T))
spread_y_knn = TG_spread$Spread

#combine x and y
#spread_knn = cbind(spread_x_knn,spread_y_knn)

set.seed (1)
iter <- 20  #iteration of K


n = nrow(spread_x_knn)
times =rep(1:6,c(1/6*n,1/6*n,1/6*n,1/6*n,1/6*n,1/6*n))
ntimes = length(times)
sets = sample(times)
all_knn_cv = cbind()

for (i in 1:6) {
  cv_test = spread_x_knn[sets==i,]
  cv_train = spread_x_knn[sets!=i,]
  Y_train = spread_y_knn[sets!=i]
  Y_test = spread_y_knn[sets==i]

  # Compute training set accuracy.
 errs = vapply(seq_len(iter), function(x){
   k = knn.reg(train = cv_train, test = cv_test, y=Y_train, k=x)
   sqrt(mean((k$pred - Y_train)^2))
  }, numeric(1))

  all_knn_cv = cbind(all_knn_cv,errs)  
}

mean_err = c()
for (i in 1:20){
  mean_err = c(mean_err, mean(all_knn_cv[i,]))
}

df <- data.frame(k = seq_len(iter), accuracy = mean_err)

set.seed (1)
# Compute accuracy on test set.

all_knn_cv_test = cbind()
for (i in 1:6) {
  cv_test = spread_x_knn[sets==i,]
  cv_train = spread_x_knn[sets!=i,]
  Y_train = spread_y_knn[sets!=i]
  Y_test = spread_y_knn[sets==i]

  # Compute training set accuracy.
 errs <- vapply(seq_len(iter), function(x){
    k <- knn(cv_train, cv_test, Y_train, k = x)
   sum(k != Y_test) / length(k)
  }, numeric(1))

  all_knn_cv_test = cbind(all_knn_cv_test,errs)  
}

mean_err_test = c()
for (i in 1:20){
  mean_err_test = c(mean_err_test, mean(all_knn_cv_test[i,]))
}

df_test <- data.frame(k = seq_len(iter), accuracy = 1-mean_err_test)
```

```{r}
RMSE(spread_test$Spread, knnreg_spread_k1$pred)
```

Baseline Linear Regression for Total
```{r}
summary(lm(Total ~ .  , data = TG_total))
```

```{r}
for_predictions = read_csv("for_predictions.csv")
```

```{r}
TG_result <- subset(TG, select = -c(Spread, Total))
result_logit_pred <- glm(WINLOSS ~ ., data = TG_result, family = binomial)

#Prediction 
result_logit_reg_prob_pred <- predict(result_logit_pred, for_predictions, type = "response")
predicted_result <- ifelse(result_logit_reg_prob_pred >= 0.5, 1, 0)
pred_result = as.data.frame(predicted_result)
head(pred_result)
pred_result
```



```{r}

#creating per-game stats

off_stats_pergame = total_off_stats %>% mutate(`PPG` = as.numeric(`Points For`)/16, `Ypergame` = as.numeric(`Total Yards`)/16, `TOpergame` = as.numeric(`Total TO`)/16, `PA_pergame` = as.numeric(`P ATT`)/16, `COMP_pergame` = as.numeric(`P Comp`)/16, `PY_pergame` = as.numeric(`P YDS`)/16, `PTD_pergame` = as.numeric(`P TD`)/16, `RA_pergame` = as.numeric(`R ATT`)/16,  `RY_pergame` = as.numeric(`R YDS`)/16, `RTD_pergame` = as.numeric(` R TD`)/16, `PEN_pergame` = as.numeric(`Pen`)/16, `PENYDS_pergame` = as.numeric(`Pen Yards`)/16, `Pass Y/A` = as.numeric(`P YDS`)/as.numeric(`P ATT`))

extra_scoring = read.csv("Scoringoff.csv") %>% rename("Year" = YEAR, "2PM" = X2PM, "2PA" = X2PA, "Team" = Tm) %>% mutate("2PM_pergame" = as.numeric(`2PM`)/16, "2PA_pergame" = as.numeric(`2PA`)/16, "XPM_pergame" = XPM/16, "XPA_pergame" = XPA/16, "FGM_pergame" = FGM/16, "FGA_pergame" = FGA/16, "Sfty_pergame" = Sfty/16)
                                                                                                                         
pergame = inner_join(off_stats_pergame, extra_scoring, by = c("Year", "Team"))
pergame = inner_join(pergame, conversions, by = c("Year", "Team"))

passdef = read.csv("PassDef.csv") 

pergame = inner_join(pergame, passdef, by = c("Year", "Team")) %>% mutate("Sacks_pergame" = Sk/16, "INT_pergame" = Int/16 )



pergame_to_2020 = pergame %>% select_("Team", "Year",  "Ypergame", "TOpergame", "PA_pergame", "COMP_pergame", "PY_pergame", "PTD_pergame", "RA_pergame", "RY_pergame", "RTD_pergame", "PEN_pergame", "PENYDS_pergame", "`2PM_pergame`", "`2PA_pergame`", "XPM_pergame", "XPA_pergame", "FGM_pergame", "FGA_pergame", "Sfty_pergame", "Sacks_pergame", "INT_pergame", "`Rush Y/A`", "`Pass Y/A`", "`3rd_Pct`", "`4th_Pct`")

```

